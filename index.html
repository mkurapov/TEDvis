<!DOCTYPE html>
<html>
<head>
	<meta name="author" content="Max Kurapov">
    <title>d3 Test</title>
    <meta charset="utf-8"/>
    <style>
        body, html {
            height: 100%;
        }

        svg {
            margin: 0 auto;
            display: block;
            position: relative;
        }

        body {
            padding-top:50px;
            margin:0;
            background-color: #F2F2F0;
            font-family: Arial, Helvetica, sans-serif;
        }

        .letter {
            opacity: 0.7;
        }

        .node {
            cursor: pointer;
            fill: #e62b1e;
            opacity: 0.2;
            transition: opacity 0.3s ease-in-out;
        }

        .node.selected {
            opacity: 1;
        }

    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/5.8.0/d3.min.js" type="text/javascript"></script>
    <script src="https://d3js.org/d3-ease.v1.min.js"></script>
</head>
<body>
        <svg width="1440" height="900">
            <path id="TED_T" class="letter technology" transform="translate(300, 300) scale(2)" d="M32.678,30.831H0V.85H101.56V30.831H68.875V118.3h-36.2V30.831Z"  fill="#e62b1e"/>
            <path id="TED_E" class="letter entertainment" transform="translate(400, 300) scale(2)"d="M107.18.85h98.75V30.831H143.38V45.293h62.55V73.5H143.38V88.319h62.55V118.3H107.18V.85Z"  fill="#e62b1e"/>
            <path id="TED_D" class="letter design" transform="translate(500, 300) scale(2)" d="M211.9.85h59.39C310.3.85,324,29.773,324,59.4c0,35.975-18.98,58.9-59.74,58.9H211.9V.85Zm36.2,87.469h14.05c22.49,0,25.66-18.337,25.66-29.27,0-7.41-2.46-27.865-28.47-27.865h-11.6Z" transform="translate(-211.9 -0.85)" fill="#e62b1e"/>
              
        </svg>
</body>
    <script type="text/javascript">


const svg = d3.select("svg"),
width = +svg.attr("width"),
height = +svg.attr("height");

const lineY = height - 200;
const TEDy = 120;
const TEDxList = [475, 625, 775];

xCenter = {
    '':null,
    'technology':0,
    'entertainment': width/2,
    'design': width
}

function determineType(tags) {
    if (!tags) { return null }
    if (tags.includes('technology')) {
        return 'technology';
    } else if (tags.includes('entertainment')) {
        return 'entertainment';
    } else if (tags.includes('design')) {
        return 'design';
    } else {
        return '';
    }
}

var simulation = d3.forceSimulation()
        .force("forceX", d3.forceX().strength(.2).x(width * .5))
        .force("forceY", d3.forceY().strength(.2).y(height * .5))
        .force("center", d3.forceCenter().x(width * .5).y(height * .5))
        .force("charge", d3.forceManyBody().strength(-100))

const SIZE = 20;

d3.csv('data-sorted.csv').then(csvData => { run(csvData)  });

function run(csvData) {
    let nodes = csvData.sort((a, b) => a.views < b.views).filter((d, i) => i < 400).map(v => { return { ...v, id: v.url, value: SIZE }});

    nodes.forEach(n => {
        n['category'] = determineType(n.tags);
    })

    simulation
        .nodes(nodes.sort((a, b) => a.views - b.views))
        .alpha(0.1)
        .force("collide", d3.forceCollide().strength(.4))
        .on("tick", function(d){
            // console.log(d);
            node.attr('cx', function(d) { return d.x; })
                .attr('cy', function(d) { return d.y; });
        });

  var node = svg
    .selectAll("circle")
    .data(nodes)
    .enter().append("circle")
    .attr("class", "node")
      .attr("r", function(d) { return SIZE + d.views/1000000})
      .attr("cx", function(d){ return d.x; })
      .attr("cy", function(d){ return d.y; });
}

function unixToDate(timestamp) {
    return new Date(+timestamp*1000);
}

    </script>
</html>
